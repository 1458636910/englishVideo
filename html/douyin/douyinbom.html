<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/iconfont.css" />
    <style>
        body,
        html {
            background: none;
        }

        #app {
            background: none;
            /*min-height: 100vh;*/
            box-sizing: border-box;
        }

        [v-cloak] {
            /*display: none;*/
        }

        #footer {
            padding-bottom: 3vw;
        }

        .footer {
            padding: 0 3vw;
            color: white;
        }

        .count {
            margin-top: 3vw;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .plBox {
            /*width: 40vw;*/
            margin-top: 3vw;
            height: 10vw;
            line-height: 10vw;
            text-align: left;
            border-radius: 5vw;
            padding-left: 3vw;
            color: #363639;
            box-sizing: border-box;
            background: rgba(204, 204, 206, 0.68);
        }

        .shopBtnBox {
            display: flex;
            align-items: center;
            /*margin-bottom: 30vw;*/
        }

        .shopBtnBox .iconfont {
            font-size: 25px;
            color: white;
        }

        .shopBtn {
            height: 35px;
            background: #FB607D;
            border-radius: 17.5px;
            margin-right: 3vw;
            padding: 0 3vw;
            color: white;
        }

        .cart {
            width: 35px;
            height: 35px;
            background: #FB607D;
            text-align: center;
            line-height: 35px;
            border-radius: 17.5px;
        }

        .cart .iconfont {
            font-size: 22px;
            color: white;
        }

        .chatlists {
            padding: 3vw;
            height: 25vw;
            overflow: scroll;
            background: rgba(0, 0, 0, 0.12);
            border-radius: 5px;
            opacity: 0;
            margin-top: 3vw;
        }

        .chatlist {
            display: flex;
            /*align-items: center;*/
            margin-bottom: 1vw;
        }

        .nameBox {
            max-width: 70vw;
        }

        .nameBox p:nth-child(1) {
            font-size: 14px;
            color: #929292;
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>
        <div class="main">
            <div></div>
            <div class="shopBtnBox">
                <div class="shopBtn" @click="openShop()">
                    <i class="iconfont">&#xe7ed;</i>
                    <span>Products 8 </span>
                    <i class="iconfont" v-if="!showShop">&#xe65a;</i>
                    <i class="iconfont" v-if="showShop">&#xe60f;</i>
                </div>
                <span class="cart" @click="goliveCart()">
                  <i class="iconfont">&#xe614;</i>
                </span>
            </div>
            <div class="chatlists" id="chatlists">
                <div class="chatlist">
                    <div class="head">
                        <img src="../../image/img7.jpg" alt="">
                    </div>
                    <div class="nameBox">
                        <p>Jean Walton</p>
                        <p>Awesome,Love It Awesome,Love It Awesome,Love It Awesome,Love It Awesome,Love It</p>
                    </div>
                </div>
            </div>
        </div>
        <footer id="footer">
            <div class="footer">
                <h3>{{full_name}}</h3>
                <p class="count">{{videotitle}}</p>
                <div class="progressBox">

                </div>
                <div class="plBox" @click="sendPl()">
                    Comments...
                </div>
            </div>
        </footer>
    </div>

</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/fastclick.js"></script>
<script src="../../script/vue.min.js"></script>
<script src="../../script/commonurl.js"></script>
<script type="text/javascript">
    var app;
    apiready = function() {
        $api.fixTabBar($api.byId('footer'));
        app = new Vue({
            el: '#app',
            data() {
                return {
                    videotitle: '',
                    full_name: '',
                    showShop: false,
                }
            },
            created() {
                this.videotitle = api.pageParam.videotitle
                this.full_name = api.pageParam.name

            },
            methods: {
                //打开购物车
                goliveCart() {
                    if ($api.getStorage('islogin') != 'true') {
                        api.execScript({
                            name: 'live_win',
                            // frameName: 'frmName',
                            script: 'pauseLive();'
                        });
                        userIslogin()
                        return
                    }
                    api.openFrame({
                        name: 'livecart',
                        url: '../live/livecart.html',
                        rect: {
                            x: 0,
                            y: 0,
                            w: api.winWidth,
                            h: api.winHeight
                        },
                        pageParam: {
                            live_id: api.pageParam.live_id
                        },
                        bounces: false,
                        bgColor: 'rgba(0,0,0,0)',
                        vScrollBarEnabled: true,
                        hScrollBarEnabled: true,
                        animation: {
                            type: "push",
                            subType: "from_bottom",
                            duration: 300
                        }
                    });
                },
                //打开商品橱窗
                openShop() {
                    this.showShop = !this.showShop
                    if (this.showShop) {
                        api.openFrame({
                            name: 'liveshop',
                            url: '../live/liveshop.html',
                            rect: {
                                x: 0,
                                y: $api.dom('#chatlists').offsetTop,
                                w: api.winWidth,
                                h: api.winHeight - $api.dom('#chatlists').offsetTop
                            },
                            pageParam: {
                                name: 'test'
                            },
                            bounces: false,
                            bgColor: 'rgba(0,0,0,0)',
                            vScrollBarEnabled: true,
                            hScrollBarEnabled: true
                        });
                    } else {
                        api.setFrameAttr({
                            name: 'liveshop',
                            bounces: false,
                            bgColor: 'rgba(0,0,0,0)',
                            vScrollBarEnabled: true,
                            hScrollBarEnabled: true,
                            hidden: true
                        });

                        // api.closeFrame({
                        //     name: 'liveshop'
                        // });

                    }

                },
                setInfo(tit, count) {
                    this.full_name = tit
                    this.videotitle = count
                },
                sendPl() {
                    api.execScript({
                        name: 'douyin_win',
                        // frameName: 'frmName',
                        script: 'sendPl();'
                    });

                    return
                    var _this = this
                    var inputField = api.require('inputField');
                    inputField.setInputFieldListener(function(ret, err) {
                        if (ret) {
                            if (ret.chatViewH < 50) {

                            }
                            console.log(JSON.stringify(ret));
                        } else {
                            console.log(JSON.stringify(err));
                        }
                    });
                    // inputField.becomeFirstResponder(function(ret, err) {
                    //     if (ret.status) {
                    //         console.log(JSON.stringify(ret));
                    //     } else {
                    //         console.log(JSON.stringify(err));
                    //     }
                    // });
                    inputField.open({
                        bgColor: '#ffffff',
                        lineColor: '#999999',
                        fileBgColor: '#f5f5f5',
                        borderColor: '#999999',
                        placeholder: '',
                        autoFocus: true,
                        maxLines: 5,
                        limitedWordsNumber: 100,
                        sendBtn: {
                            bg: '#FB607D',
                            title: 'Send',
                            titleColor: '#fff',
                            bgHighlight: '#e67187',
                        },
                        fixedOn: api.frameName
                    }, function(ret, err) {
                        if (ret) {
                            if (ret.msg != '') {
                                console.log(ret.msg + 'end');
                                // _this.sendPl(ret.msg)
                                inputField.resignFirstResponder();
                                api.sendEvent({
                                    name: 'livechatText',
                                    extra: {
                                        msg: ret.msg,
                                    }
                                });
                            }
                            // alert(JSON.stringify(ret));


                        } else {
                            // alert(JSON.stringify(err));
                        }
                    });
                    inputField.setInputFieldListener(function(ret, err) {
                        if (ret) {
                            console.log(JSON.stringify(ret));
                            if (ret.chatViewH <= 50) {
                                inputField.close();
                            }
                            // alert(JSON.stringify(ret));
                        } else {
                            // alert(JSON.stringify(err));
                        }
                    });

                },


            }
        })

    };

    function closeWin() {
        api.closeWin();
    }
</script>

</html>

<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/iconfont.css" />
    <style>
        body {}

        #app {
            background: white;
            min-height: 100vh;
        }
        [v-cloak]{
          /*display: none;*/
        }
        /**/
        .videoLists{
          padding: 3vw;
          display: flex;
          flex-wrap: wrap;
        }
        .videoName{
          overflow: hidden;
          text-overflow: ellipsis;
       display: -webkit-box;
       -webkit-line-clamp: 1;
       -webkit-box-orient: vertical;
       color: #283858;
        }
        .videodes{
          width: 45vw;
            overflow: hidden;
            text-overflow: ellipsis;
         display: -webkit-box;
         -webkit-line-clamp: 1;
         -webkit-box-orient: vertical;
         color: #999999;
         font-size: 12px;
        }
        .videolist .livelist{
          margin-right: 0
        }
        .videolist{
          margin-right: 3vw;
          margin-bottom: 3vw;
        }
        .videolist:nth-child(2n+2){
          margin-right: 0;
        }
        /**/
        .livelists{
          padding: 3vw;
          display: flex;
          flex-wrap: wrap;
        }
        .livelist{
          width: 45vw;
          height: 25vw;
          border-radius: 5px;
          overflow: hidden;
          margin-right: 3vw;
          margin-bottom: 3vw;
          position: relative;
        }
        .livelist:nth-child(2n+2){
          margin-right: 0;
        }
        .liveimg{
          width: 45vw;
          height: 25vw;
          border-radius: 5px;
          object-fit: cover;
        }
        .livetop{
          width: 100%;
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          padding: 1vw;
          color: white;
          font-size: 12px;
        }
        .livetop span:nth-child(1){
          background: #FA607D;
          padding: 1px 10px;
          border-radius: 10px;
          font-size: 13px;
        }
        .livebom{
          width: 100%;
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          padding: 1vw;
          box-sizing: border-box;
          display: flex;
          justify-content: space-between;
        }
        .livehead{
          display: flex;
          align-items: center;
          color: white;
          font-size: 13px;
        }
        .livehead img{
          width: 8vw;
          height: 8vw;
          border-radius: 50%;
          margin-right: 5px;
        }
        .scnum{
          display: flex;
          align-items: center;
          font-size: 12px;
          color: white;
        }
        /**/
        .gjp{
          background: #f5f5f5;
        }
        .gjp.videoName,.gjp.videodes{
          height: 12px;
          margin-bottom: 5px;
        }

    </style>
</head>

<body>
    <div id="app" v-cloak>

      <div class="videoLists" v-if="list.length == 0 && !nodata">
        <div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div><div class="videolist" @click="godouyin()">
          <div class="livelist gjp"></div>
          <p class="videoName gjp"></p>
          <p class="videodes gjp"></p>
        </div>
      </div>
      <div class="empty" v-if="list.length == 0 && nodata">
        <img src="../../image/empty.png" alt="">
      </div>
      <div class="videoLists">
        <div class="videolist" @click="gonews(item)" v-for="(item,index) in list">
          <div class="livelist">
            <img class="liveimg" :src="item.thumbs[0]" alt="">
            <div class="livetop">
              <span style="display:none">Live</span>
              <span>
                <i class="iconfont">&#xe629;</i>
                {{item.look_count}}
              </span>
            </div>
          </div>
          <p class="videoName">{{item.author}}</p>
          <p class="videodes">{{item.title}}</p>
        </div>
      </div>


    </div>

</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/fastclick.js"></script>
<script src="../../script/vue.min.js"></script>
<script src="../../script/commonurl.js"></script>
<script type="text/javascript">
    apiready = function() {
        var app = new Vue({
            el: '#app',
            data() {
                return {
                  type:'',
                  active:1,
                  keywords:'',
                  list:[],
                  page:1,
                  allpage:1,
                  more:true,
                  last_news_id:0,
                  nodata:false,
                }
            },
            created() {
              this.keywords = api.pageParam.keywords
              // alert(this.keywords)
              this.type = api.pageParam.type
              // alert(api.pageParam.type)
              // this.resresh()
              this.getLists()
              this.getMore()
            },
            methods: {
              gonews(ite){
                api.openWin({
                    name: 'newsdetail_win',
                    url: '../common/newsdetail_win.html',
                    pageParam: {
                        id: ite.id
                    }
                });
              },
              getLists(){
                var _this = this;
                var data = {
                  keyword:api.pageParam.keywords,
                  last_news_id:_this.last_news_id,
                  page:_this.page,
                  page_size:20,
                };
                requstPost('news',data,function success(ret){
                  if (ret.code == 0) {
                    _this.last_video_id = ret.data.last_video_id
                    _this.list = _this.list.concat(ret.data.list)
                    if (ret.data.list.length < 20) {
                      _this.more = false
                    }
                  }else {
                    _this.more = false
                    _this.nodata = true
                  }
                },function fail(err){

                })
              },
              changeNav(e){
                this.active = e
              },
              //监听滚动到底

              getMore() {
                var _this = this
                api.addEventListener({
                    name: 'scrolltobottom',
                    extra: {
                        threshold: 0 //设置距离底部多少距离时触发，默认值为0，数字类型
                    }
                }, function(ret, err) {
                  console.log('加载更多');
                  console.log(_this.page);
                    console.log(_this.allpage);
                    // _this.page += 1
                    if (_this.page == 1) {
                      return
                    }
                    if (_this.page > _this.allpage) {
                      // _this.isloading = true
                    }else {
                      _this.getKeywordsList1()
                    }
                });

              },

              getKeywordsList(){
                api.showProgress({
                    style: 'default',
                    animationType: 'fade',
                    title: '数据加载中...',
                    text: '',
                    modal: true
                });

                var _this = this
                api.ajax({
                    url: url+'userApi/goods/search',
                    method: 'post',
                    data: {
                        values: {
                          token:$api.getStorage('token'),
                          search:_this.keywords,
                          page:1
                        }
                    }
                },function(ret, err){
                  api.hideProgress();

                    if (ret) {
                      if (ret.code == 1000) {
                        _this.page = 2
                        _this.list = ret.data.data
                        // _this.list = ret.data.list
                        _this.allpage = ret.data.last_page
                      }
                        // alert( JSON.stringify( ret ) );
                    } else {
                      api.toast({
                          msg: err.msg,
                          duration: 2000,
                          location: 'middle'
                      });

                        // alert( JSON.stringify( err ) );
                    }
                });
              },

                getKeywordsList1(){
                  var _this = this
                  api.ajax({
                      url: url+'userApi/goods/search',
                      method: 'post',
                      data: {
                          values: {
                            token:$api.getStorage('token'),
                            search:_this.keywords,
                            page:_this.page
                          }
                      }
                  },function(ret, err){
                      if (ret) {
                        if (ret.code == 1000) {
                          _this.page += 1
                          _this.list =_this.list.concat(ret.data.data)
                          _this.allpage = ret.data.last_page
                        }
                          // alert( JSON.stringify( ret ) );
                      } else {
                        api.toast({
                            msg: err.msg,
                            duration: 2000,
                            location: 'middle'
                        });

                          // alert( JSON.stringify( err ) );
                      }
                  });
                },
              //查看商品详情
            goshopdetail(ite){
              api.openWin({
                  name: 'shopdetail_win',
                  url: './store/shopdetail_win.html',
                  pageParam: {
                      id: ite.goods_id,
                      type:1
                  }
              });

            },
              resresh(){
                var _this = this
                    api.setRefreshHeaderInfo({
                        visible: true,
                        loadingImg: 'widget://image/loading_more1.png',
                        bgColor: '#ffffff',
                        textColor: '#000',
                        textDown: '下拉刷新...',
                        textUp: '松开刷新...'
                    }, function(ret, err) {
                      _this.getKeywordsList()
                      setTimeout(()=>{
                        api.refreshHeaderLoadDone();
                      },2000)
                    });
              },


            }
        })

    };
</script>

</html>
